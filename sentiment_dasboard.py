# -*- coding: utf-8 -*-
"""Sentiment Dasboard.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1g2LmEQ5IX8dEqeGrJrCOju7dXpEy023W
"""

import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
from wordcloud import WordCloud
from keras.models import load_model
from tensorflow.keras.preprocessing.sequence import pad_sequences
from tensorflow.keras.preprocessing.text import tokenizer_from_json
import json

from utils import show_game_description, show_sentiment_charts, show_wordclouds, analyze_user_input

model = load_model("model/sentiment_model.keras")
with open("model/tokenizer_lstm.json") as f:
    tokenizer_json = json.load(f)
tokenizer = tokenizer_from_json(tokenizer_json)

st.sidebar.title("ðŸ“Š Dashboard Sentimen Komentar")
game_choice = st.sidebar.selectbox("ðŸŽ® Pilih Game", ["Genshin Impact", "Wuthering Waves"])
section = st.sidebar.radio("ðŸ“Œ Pilih Section", ["Section 1: Analisa", "Section 2: Word Cloud", "Section 3: Uji Coba Model"])

if game_choice == "Genshin Impact":
    df = pd.read_csv("data/Sentiment_Genshin.csv")
else:
    df = pd.read_csv("data/Sentiment_Wuthering.csv")

st.title("Analisis Sentimen Komentar Game ðŸŽ®")
st.markdown("""
Dashboard ini menggunakan pendekatan **TF-IDF + MLPClassifier** serta model **LSTM** untuk menganalisis komentar dari pengguna terhadap game Genshin Impact dan Wuthering Waves.

Model LSTM dipilih karena kemampuannya dalam memahami konteks urutan kata, sementara TF-IDF + MLP digunakan untuk baseline perbandingan karena efisiensi dan interpretabilitasnya.
""")

if section.startswith("Section 1"):
    show_game_description(game_choice)
    show_sentiment_charts(df, game_choice)

elif section.startswith("Section 2"):
    show_wordclouds(df)

elif section.startswith("Section 3"):
    st.subheader("ðŸ§ª Uji Coba Model Sentimen")
    user_input = st.text_input("Masukkan kalimat komentar:")
    if user_input:
        analyze_user_input(user_input, model, tokenizer)
